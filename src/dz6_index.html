<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dz6</title>
</head>
<body>
    <div id="homework-container">
        <div id="loading-block"></div>
            <input type="text" id="filter-input">
            <ul id="filter-result"></ul>

    </div>


<script>
    let homeworkContainer = document.querySelector('#homework-container');

    /**
     * Функция должна загружать список городов из https://raw.githubusercontent.com/smelukov/citiesTest/master/cities.json
     * И возвращать Promise, которой должен разрешиться массивом загруженных городов
     *
     * @return {Promise<Array<{name: string}>>}
     */
    function loadTowns() {
        var promise = new Promise((resolve, reject) => {

            var req = new XMLHttpRequest();

            req.open('GET', 'https://raw.githubusercontent.com/smelukov/citiesTest/master/cities.json', true)
            req.responseType = 'json';
            req.onprogress = () => {
                loadingBlock.style.display = 'block';
                loadingBlock.innerText = 'Загрузка...';
            };
            req.onload = () => {
                var res = req.response;

                res.sort(function (a, b) { //является ли эта ф-ия callback ?
                    if (a.name > b.name) {
                        return 1;
                    }
                    if (a.name < b.name) {
                        return -1;
                    }
                    // a должно быть равным b
                    return 0;
                });

                resolve(res);
            };
            req.send();
        });

        return promise;
    }

    /**
     * Функция должна проверять встречается ли подстрока chunk в строке full
     * Проверка должна происходить без учета регистра символов
     *
     * @example
     * isMatching('Moscow', 'moscow') // true
     * isMatching('Moscow', 'mosc') // true
     * isMatching('Moscow', 'cow') // true
     * isMatching('Moscow', 'SCO') // true
     * isMatching('Moscow', 'Moscov') // false
     *
     * @return {boolean}
     */
    function isMatching(full, chunk) {
        full = full.toLowerCase();
        chunk = chunk.toLowerCase();
        if (~full.indexOf(chunk)) {

            return true;
        } else {

            return false;
        }
    }

    let loadingBlock = homeworkContainer.querySelector('#loading-block');
    let filterBlock = homeworkContainer.querySelector('#filter-block');
    let filterInput = homeworkContainer.querySelector('#filter-input');
    let filterResult = homeworkContainer.querySelector('#filter-result');
    let townsPromise;



    loadTowns()
        .then(response => {
            loadingBlock.style.display = 'none';

            filterInput.addEventListener('keyup', function() {
                var chunk = filterInput.value;
                var ress = [];

                filterResult.innerHTML = '';
                if(chunk != '') {
                    for (var i = 0; i < response.length; i++) {
                        if (isMatching(response[i].name, chunk)) {
                            ress.push(chunk);
                        }
                    }

                    ress.forEach(function (item) {
                        filterResult.innerHTML += '<li>' + item + '</li>';
                    });
                };
            });
        });


</script>

</body>
</html>